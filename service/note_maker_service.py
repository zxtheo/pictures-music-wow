#note_maker_service
from data.note_data import NoteData
import math
frequency = {'1': 261.63, '2': 261.63, '3': 261.63, '4': 261.63, '5': 261.63, '6': 261.63, '7': 261.63, '8': 261.63, '9': 261.63, '10': 261.63, '11': 261.63, '12': 261.63, '13': 261.63, '14': 261.63, '15': 261.63, '16': 261.63, '17': 261.63, '18': 293.66, '19': 293.66, '20': 293.66, '21': 293.66, '22': 293.66, '23': 293.66, '24': 293.66, '25': 293.66, '26': 293.66, '27': 293.66, '28': 293.66, '29': 293.66, '30': 293.66, '31': 293.66, '32': 293.66, '33': 293.66, '34': 293.66, '35': 329.63, '36': 329.63, '37': 329.63, '38': 329.63, '39': 329.63, '40': 329.63, '41': 329.63, '42': 329.63, '43': 329.63, '44': 329.63, '45': 329.63, '46': 329.63, '47': 329.63, '48': 329.63, '49': 329.63, '50': 329.63, '51': 329.63, '52': 349.23, '53': 349.23, '54': 349.23, '55': 349.23, '56': 349.23, '57': 349.23, '58': 349.23, '59': 349.23, '60': 349.23, '61': 349.23, '62': 349.23, '63': 349.23, '64': 349.23, '65': 349.23, '66': 349.23, '67': 349.23, '68': 349.23, '69': 392.0, '70': 392.0, '71': 392.0, '72': 392.0, '73': 392.0, '74': 392.0, '75': 392.0, '76': 392.0, '77': 392.0, '78': 392.0, '79': 392.0, '80': 392.0, '81': 392.0, '82': 392.0, '83': 392.0, '84': 392.0, '85': 392.0, '86': 440.0, '87': 440.0, '88': 440.0, '89': 440.0, '90': 440.0, '91': 440.0, '92': 440.0, '93': 440.0, '94': 440.0, '95': 440.0, '96': 440.0, '97': 440.0, '98': 440.0, '99': 440.0, '100': 440.0, '101': 440.0, '102': 440.0, '103': 493.88, '104': 493.88, '105': 493.88, '106': 493.88, '107': 493.88, '108': 493.88, '109': 493.88, '110': 493.88, '111': 493.88, '112': 493.88, '113': 493.88, '114': 493.88, '115': 493.88, '116': 493.88, '117': 493.88, '118': 493.88, '119': 493.88, '120': 523.25, '121': 523.25, '122': 523.25, '123': 523.25, '124': 523.25, '125': 523.25, '126': 523.25, '127': 523.25, '128': 523.25, '129': 523.25, '130': 523.25, '131': 523.25, '132': 523.25, '133': 523.25, '134': 523.25, '135': 523.25, '136': 523.25, '137': 587.33, '138': 587.33, '139': 587.33, '140': 587.33, '141': 587.33, '142': 587.33, '143': 587.33, '144': 587.33, '145': 587.33, '146': 587.33, '147': 587.33, '148': 587.33, '149': 587.33, '150': 587.33, '151': 587.33, '152': 587.33, '153': 587.33, '154': 659.25, '155': 659.25, '156': 659.25, '157': 659.25, '158': 659.25, '159': 659.25, '160': 659.25, '161': 659.25, '162': 659.25, '163': 659.25, '164': 659.25, '165': 659.25, '166': 659.25, '167': 659.25, '168': 659.25, '169': 659.25, '170': 659.25, '171': 698.46, '172': 698.46, '173': 698.46, '174': 698.46, '175': 698.46, '176': 698.46, '177': 698.46, '178': 698.46, '179': 698.46, '180': 698.46, '181': 698.46, '182': 698.46, '183': 698.46, '184': 698.46, '185': 698.46, '186': 698.46, '187': 698.46, '188': 783.99, '189': 783.99, '190': 783.99, '191': 783.99, '192': 783.99, '193': 783.99, '194': 783.99, '195': 783.99, '196': 783.99, '197': 783.99, '198': 783.99, '199': 783.99, '200': 783.99, '201': 783.99, '202': 783.99, '203': 783.99, '204': 783.99, '205': 880.0, '206': 880.0, '207': 880.0, '208': 880.0, '209': 880.0, '210': 880.0, '211': 880.0, '212': 880.0, '213': 880.0, '214': 880.0, '215': 880.0, '216': 880.0, '217': 880.0, '218': 880.0, '219': 880.0, '220': 880.0, '221': 880.0, '222': 987.77, '223': 987.77, '224': 987.77, '225': 987.77, '226': 987.77, '227': 987.77, '228': 987.77, '229': 987.77, '230': 987.77, '231': 987.77, '232': 987.77, '233': 987.77, '234': 987.77, '235': 987.77, '236': 987.77, '237': 987.77, '238': 987.77, '239': 1046.5, '240': 1046.5, '241': 1046.5, '242': 1046.5, '243': 1046.5, '244': 1046.5, '245': 1046.5, '246': 1046.5, '247': 1046.5, '248': 1046.5, '249': 1046.5, '250': 1046.5, '251': 1046.5, '252': 1046.5, '253': 1046.5, '254': 1046.5, '255': 1046.5}

def make_notes(image_data, bpm):
    music_score = []
    for pixel in image_data:
        pitch = get_pitch(pixel.r)
        length = get_length(pixel.g, bpm)
        rest = get_rest(pixel.b, bpm)
        music_score.append(NoteData(pitch, length, rest).to_list())
    return music_score

def get_pitch(n):
    return frequency[str(n)]

def get_length(n, bpm):
    return get_note_length(n, bpm)

def get_rest(n, bpm):
    return get_note_length(n, bpm)

def get_note_length(n, bpm):
    lengths = {
        "0":(60/bpm)/4, #1/4
        "1":(60/bpm)/2, #1/2
        "2":(60/bpm),   #1
        "3":(60/bpm)*2, #2
        "4":(60/bpm)*3, #3
        "5":(60/bpm)*4  #4
    }

    return lengths[str(round(n/51))]



    

