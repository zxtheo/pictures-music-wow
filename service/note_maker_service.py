#note_maker_service
from data.note_data import NoteData
import math

frequency = {'0': 60, '1': 60, '2': 60, '3': 60, '4': 60, '5': 60, '6': 60, '7': 60, '8': 60, '9': 60, '10': 62, '11': 62, '12': 62, '13': 62, '14': 62, '15': 62, '16': 62, '17': 62, '18': 62, '19': 62, '20': 62, '21': 62, '22': 62, '23': 62, '24': 62, '25': 62, '26': 62, '27': 64, '28': 64, '29': 64, '30': 64, '31': 64, '32': 64, '33': 64, '34': 64, '35': 64, '36': 64, '37': 64, '38': 64, '39': 64, '40': 64, '41': 64, '42': 64, '43': 64, '44': 64, '45': 64, '46': 65, '47': 65, '48': 65, '49': 65, '50': 65, '51': 65, '52': 65, '53': 65, '54': 65, '55': 65, '56': 65, '57': 65, '58': 65, '59': 65, '60': 65, '61': 65, '62': 65, '63': 67, '64': 67, '65': 67, '66': 67, '67': 67, '68': 67, '69': 67, '70': 67, '71': 67, '72': 67, '73': 67, '74': 67, '75': 67, '76': 67, '77': 67, '78': 67, '79': 67, '80': 67, '81': 67, '82': 69, '83': 69, '84': 69, '85': 69, '86': 69, '87': 69, '88': 69, '89': 69, '90': 69, '91': 69, '92': 69, '93': 69, '94': 69, '95': 69, '96': 69, '97': 69, '98': 69, '99': 71, '100': 71, '101': 71, '102': 71, '103': 71, '104': 71, '105': 71, '106': 71, '107': 71, '108': 71, '109': 71, '110': 71, '111': 71, '112': 71, '113': 71, '114': 71, '115': 71, '116': 71, '117': 71, '118': 72, '119': 72, '120': 72, '121': 72, '122': 72, '123': 72, '124': 72, '125': 72, '126': 72, '127': 72, '128': 72, '129': 72, '130': 72, '131': 72, '132': 72, '133': 72, '134': 72, '135': 74, '136': 74, '137': 74, '138': 74, '139': 74, '140': 74, '141': 74, '142': 74, '143': 74, '144': 74, '145': 74, '146': 74, '147': 74, '148': 74, '149': 74, '150': 74, '151': 74, '152': 74, '153': 74, '154': 76, '155': 76, '156': 76, '157': 76, '158': 76, '159': 76, '160': 76, '161': 76, '162': 76, '163': 76, '164': 76, '165': 76, '166': 76, '167': 76, '168': 76, '169': 76, '170': 76, '171': 77, '172': 77, '173': 77, '174': 77, '175': 77, '176': 77, '177': 77, '178': 77, '179': 77, '180': 77, '181': 77, '182': 77, '183': 77, '184': 77, '185': 77, '186': 77, '187': 77, '188': 77, '189': 77, '190': 79, '191': 79, '192': 79, '193': 79, '194': 79, '195': 79, '196': 79, '197': 79, '198': 79, '199': 79, '200': 79, '201': 79, '202': 79, '203': 79, '204': 79, '205': 79, '206': 79, '207': 81, '208': 81, '209': 81, '210': 81, '211': 81, '212': 81, '213': 81, '214': 81, '215': 81, '216': 81, '217': 81, '218': 81, '219': 81, '220': 81, '221': 81, '222': 81, '223': 81, '224': 81, '225': 81, '226': 83, '227': 83, '228': 83, '229': 83, '230': 83, '231': 83, '232': 83, '233': 83, '234': 83, '235': 83, '236': 83, '237': 83, '238': 83, '239': 83, '240': 83, '241': 83, '242': 83, '243': 84, '244': 84, '245': 84, '246': 84, '247': 84, '248': 84, '249': 84, '250': 84, '251': 84, '252': 84, '253': 84, '254': 84, '255': 84}

def make_notes(image_data, ipitch, ilength, irest, bpm):
    music_score = []
    for pixel in image_data:
        rgb = pixel.to_list()
        rgb_dict = {'r': 0, 'g': 1, 'b':2}
        pitch = get_pitch(rgb[rgb_dict[ipitch]])
        length = get_length(rgb[rgb_dict[ilength]], bpm)
        rest = get_rest(rgb[rgb_dict[irest]], bpm)
        music_score.append(NoteData(pitch, length, rest))
    return music_score

def get_pitch(n):
    return frequency[str(n)]

def get_length(n, bpm):
    return get_note_length(n, bpm)

def get_rest(n, bpm):
    return get_note_length(n, bpm)/1000/1000

def get_note_length(n, bpm):
    lengths = {
        "0":(60/bpm)/4, #1/4
        "1":(60/bpm)/2, #1/2
        "2":(60/bpm)  , #1
        "3":(60/bpm)*2, #2
        "4":(60/bpm)*4  #4
    }

    return lengths[str(round(n/63))]



    

