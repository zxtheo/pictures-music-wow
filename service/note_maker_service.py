#note_maker_service
from data.note_data import NoteData
import math
frequency = {'0': 262, '1': 262, '2': 262, '3': 262, '4': 262, '5': 262, '6': 262, '7': 262, '8': 262, '9': 262, '10': 294, '11': 294, '12': 294, '13': 294, '14': 294, '15': 294, '16': 294, '17': 294, '18': 294, '19': 294, '20': 294, '21': 294, '22': 294, '23': 294, '24': 294, '25': 294, '26': 294, '27': 330, '28': 330, '29': 330, '30': 330, '31': 330, '32': 330, '33': 330, '34': 330, '35': 330, '36': 330, '37': 330, '38': 330, '39': 330, '40': 330, '41': 330, '42': 330, '43': 330, '44': 330, '45': 330, '46': 349, '47': 349, '48': 349, '49': 349, '50': 349, '51': 349, '52': 349, '53': 349, '54': 349, '55': 349, '56': 349, '57': 349, '58': 349, '59': 349, '60': 349, '61': 349, '62': 349, '63': 392, '64': 392, '65': 392, '66': 392, '67': 392, '68': 392, '69': 392, '70': 392, '71': 392, '72': 392, '73': 392, '74': 392, '75': 392, '76': 392, '77': 392, '78': 392, '79': 392, '80': 392, '81': 392, '82': 440, '83': 440, '84': 440, '85': 440, '86': 440, '87': 440, '88': 440, '89': 440, '90': 440, '91': 440, '92': 440, '93': 440, '94': 440, '95': 440, '96': 440, '97': 440, '98': 440, '99': 494, '100': 494, '101': 494, '102': 494, '103': 494, '104': 494, '105': 494, '106': 494, '107': 494, '108': 494, '109': 494, '110': 494, '111': 494, '112': 494, '113': 494, '114': 494, '115': 494, '116': 494, '117': 494, '118': 523, '119': 523, '120': 523, '121': 523, '122': 523, '123': 523, '124': 523, '125': 523, '126': 523, '127': 523, '128': 523, '129': 523, '130': 523, '131': 523, '132': 523, '133': 523, '134': 523, '135': 587, '136': 587, '137': 587, '138': 587, '139': 587, '140': 587, '141': 587, '142': 587, '143': 587, '144': 587, '145': 587, '146': 587, '147': 587, '148': 587, '149': 587, '150': 587, '151': 587, '152': 587, '153': 587, '154': 659, '155': 659, '156': 659, '157': 659, '158': 659, '159': 659, '160': 659, '161': 659, '162': 659, '163': 659, '164': 659, '165': 659, '166': 659, '167': 659, '168': 659, '169': 659, '170': 659, '171': 698, '172': 698, '173': 698, '174': 698, '175': 698, '176': 698, '177': 698, '178': 698, '179': 698, '180': 698, '181': 698, '182': 698, '183': 698, '184': 698, '185': 698, '186': 698, '187': 698, '188': 698, '189': 698, '190': 784, '191': 784, '192': 784, '193': 784, '194': 784, '195': 784, '196': 784, '197': 784, '198': 784, '199': 784, '200': 784, '201': 784, '202': 784, '203': 784, '204': 784, '205': 784, '206': 784, '207': 880, '208': 880, '209': 880, '210': 880, '211': 880, '212': 880, '213': 880, '214': 880, '215': 880, '216': 880, '217': 880, '218': 880, '219': 880, '220': 880, '221': 880, '222': 880, '223': 880, '224': 880, '225': 880, '226': 988, '227': 988, '228': 988, '229': 988, '230': 988, '231': 988, '232': 988, '233': 988, '234': 988, '235': 988, '236': 988, '237': 988, '238': 988, '239': 988, '240': 988, '241': 988, '242': 988, '243': 1047, '244': 1047, '245': 1047, '246': 1047, '247': 1047, '248': 1047, '249': 1047, '250': 1047, '251': 1047, '252': 1047, '253': 1047, '254': 1047, '255': 1047}
def make_notes(image_data, ipitch, ilength, irest, bpm):
    music_score = []
    for pixel in image_data:
        rgb = pixel.to_list()
        rgb_dict = {'r': 0, 'g': 1, 'b':2}
        pitch = get_pitch(rgb[rgb_dict[ipitch]])
        length = get_length(rgb[rgb_dict[ilength]], bpm)
        rest = get_rest(rgb[rgb_dict[irest]], bpm)
        music_score.append(NoteData(pitch, length, rest))
    return music_score

def get_pitch(n):
    return frequency[str(n)]

def get_length(n, bpm):
    return get_note_length(n, bpm)

def get_rest(n, bpm):
    return get_note_length(n, bpm)/1000/1000

def get_note_length(n, bpm):
    lengths = {
        "0":int((60/4/bpm)/4 * 1000), #1/4
        "1":int((60/4/bpm)/2 * 1000), #1/2
        "2":int((60/4/bpm)   * 1000), #1
        "3":int((60/4/bpm)*2 * 1000), #2
        "4":int((60/4/bpm)*4 * 1000)  #4
    }

    return lengths[str(round(n/63))]



    

